#!/bin/bash

NETCONFIG_PATH=/etc/sysconfig/network-scripts

find ${NETCONFIG_PATH} -name "ifcfg-*" -type f | xargs egrep -i -L "lo|USER" | xargs rm
for iface in $(ls /sys/class/net); do
    # Only configure physical interfaces
    if readlink /sys/class/net/$iface | grep --invert-match --silent 'virtual'; then
        echo "# Generated by $(basename $0)
TYPE=\"Ethernet\"
BOOTPROTO=\"dhcp\"
DEFROUTE=\"yes\"
IPV4_FAILURE_FATAL=\"no\"
UUID=\"$(uuidgen)\"
DEVICE=\"$iface\"
ONBOOT=\"yes\"
PERSISTENT_DHCLIENT=\"1\"
# Uncomment to enable IPv6
#IPV6INIT=\"yes\"
#IPV6_AUTOCONF=\"yes\"
#IPV6_DEFROUTE=\"yes\"
#IPV6_FAILURE_FATAL=\"no\"
" > ${NETCONFIG_PATH}/ifcfg-${iface}
    fi

done

# Ensure network is started at boot
systemctl unmask network
systemctl enable network
